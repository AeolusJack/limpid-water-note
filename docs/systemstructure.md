# 计算机系统结构

## 计算机系统结构基本概念

### 计算机系统结构

- 计算机系统层次结构

	- 

- 计算机系统结构定义

	- Amdahl等人定义：由程序设计者所看到的计算机系统结构的属性，即概念性结构和功能特性。实际是计算机系统结构的外特性。其所说的程序设计者指机器语言或编译程序设计者所看到的计算机属性。
	- 透明：在计算机技术中，一种本来存在的事物或熟悉，在某种程度或角度看不到，称为透明。
	- 研究的是计算机系统的软硬件界面
	- 随着发展，还应包括功能模块的设计

- 计算机组成与实现

	- 计算机组成是计算机系统结构的逻辑实现
	- 计算机实现是指计算机组成的物理实现
	- 计算机系统结构，组成和实现包含的具体内容是根据不同的机器有所变化的（其实主要看是否涉及到了软硬件界面）

- 计算机系统结构的分类

  分类即是按照不同角度或维度去做的分类，具体聊，要看是聊什么问题了，那种维度的分类更容易解释问题就用哪种
  
  
	- 1.Flynn分类法

		- 定义：指令流，数据流，多倍性。
		- 根据指令流数据流的不同组织方式分四类：

			- 

	- 其他分类：通常按照性能和价格的综合指标分为巨大中小微几类。按照使用性质分科学计算，家用等等。按处理机数分单处理机，多处理机等等。
	- 2.冯氏分类法（指的是冯泽云提出的那个冯氏分类）

		- 用最大并行度对计算机系统结构进行分类

			- 最大并行度Pm：计算机系统在单位时间内能够处理的最大的二进制位数。

		- 平均并行度Pa
		- 周期T内平均利用率为：u=Pa/Pm
		- 四类不同方法的计算机系统处理结构

			- 

	- 3.Handler分类法(handler根据并行度和流水线提出的另一种分类法）

		- 该分类法把硬件结构分为了三个层次：

			- 

		- 

### 计算机系统设计技术

- 计算机系统设计的定量原理

	- 加快经常性事件的速度

		- Amdahl定律解决此问题

	- Amdahl定律

		- 系统中某一部件由于采用某种更快的执行方式带给整个系统的提高，与这一执行方式在整个系统中所占的频率或执行时间的比例。
		- 加速比=改进措施后的性能/没有改进措施前的性能
=没有采用改进措施前执行某任务的时间/采用改进措施后执行某任务的时间
		- 
		- 上图Fe为未改进前该任务执行时间占总任务时间的百分比，Se为（改进前改进部分的执行时间/改进后改进部分的执行时间）

	- CPU性能公式

		- 时钟可以用时钟周期的长度或者频率来表示
		- 一个程序所化的CPU时间可以用两种方式来表示：

			- CPU时间=CPU时钟周期数/频率，CPU时间=CPU时钟周期数/时钟周期长

		- 平均时钟周期数CPI=CPU时钟周期数目/IC，IC表示指令条数
		- CPU时间=IC*CPI*时钟周期长度，CPU时间=（IC*CPI）/频率
		- 
		- CPU的性能取决于三个要素：

			- 1时钟频率，2每条指令所化的时钟周期数，3指令条数IC

	- 访问的局部性原理

		- 时间上的局部性是指最近访问过的代码是不久将被访问的代码
		- 空间上的局部性是指那些地址上相邻的代码可能被一起访问

- 计算机系统设计者的主要任务

	- 确定用户对计算机系统功能，价格和性能的要求

		- 功能要求包括：

			- 应用领域
			- 软件兼容层次
			- 操作系统需求
			- 标准

	- 软硬件的平衡
	- 设计出符合今后发展方向的系统结构

- 计算机系统设计的主要方法（与计算机系统结构分层有关）

	- “由下往上”设计
	- “由上往下”设计
	- “由中间开始”设计

### 系统结构的评价标准

- 性能

	- 主要标准

		- 时间是衡量计算机性能的标准，CPU时间分为用户时间和系统时间，我们讲的CPU时间就是指用户时间，即用户程序的执行时间
		- mips有三个比较大的缺陷：依赖于指令集，mips大小可能性能相反，同台机器mips因程序而变化
		- 
		- 用基准测试程序来测试评价机器的性能

	- 性能的比较

		- 总执行时间：一致的衡量标准
		- 加权执行时间

- 成本

	- 成本指标（软硬件）

		- 一次性开发成本
		- 每个部件的生产成本

	- 硬件考虑

### 计算机系统结构的发展

- 冯•诺依曼结构

	- 冯·诺一曼计算机的特征

		- 

	- 

- 软件对系统结构的影响（解决软件的可移植性问题）

	- 采用系列机方法
	- 采用模拟与仿真方法
	- 采用统一的高级语言方法

- 价格对系统结构的影响
- 应用对系统结构的影响

	- 

- VlSI对系统结构的影响
- 技术的发展对价格的影响

	- 增加每个机器周期执行指令条数的方法

		- 减少要执行的指令条数
		- 在系统结构中增加硬件辅助部件，以改进系统结构效率。
		- 多条指令并发执行

- 算法和系统结构

## 指令系统

### 数据表示

- 数据表示与数据类型

	- 数据表示研究计算机硬件能够直接识别，可以被指令系统直接调用的那些类型
	- 数据结构研究的是除了数据表示之外的所有数据类型
	- 阵列，布尔型，实数，整数，链表，图，文件等等数据类型被研究那些用软件实现，那些用硬件实现

- 浮点数据表示

	- 数据字长确定的前提下，研究浮点数的表数范围，表数精度，表数效率，以及他们之间的关系。企图找到一种几个属性最大化的一种表数方式。

		- 浮点数的表数范围

			- 
			- 

		- 浮点数的表数精度
		- 浮点数的表数效率

			- 通常把最高位为零的浮点数称为规格化浮点数

		- 浮点数尾数基值的选择
		- 浮点数格式的设计
		- 浮点数的舍入处理

			- 恒舍法，又称截断法，是一种最容易实现的舍入法
			- 恒置法，实现难度仅次于恒舍法
			- 下舍上入法，精度高，积累误差小
			- R*舍入法，根据有效位p位之外的数据值来选择使用恒置还是下舍上入等法
			- 查表法，又称ROM舍入法，PLA舍入法，精度与下舍上入类似，实现稍易
			- 

		- 警戒位的设置方法

			- 为了保证浮点数的运算精度，在规定的尾数字长之外，需要在累加器中另外增加的长度，称为警戒位

- 自定义数据表示

	- 带标志符的数据表示法

		- 优点：1简化了指令系统，2由硬件自动实现了一致性检查和数据类型的转换，3简化程序设计，4简化编译器，5支持数据库系统，6方便软件调试
		- 缺点：1数据和指令的长度可能不一致，2指令的执行速度降低，3硬件复杂度增加

	- 数据描述符表示法

		- 标志符作用一个数据，而描述符作用一组数据。
		- 标志符与数据存放一个存储单元，而描述符单独存放一个存储单元。
		- 描述符用来存放数据块的地址，一组数据的属性，特征，类型或其他信息等。

### 寻址技术

- 编址方式

	- 编址单位

		- 字编址，字节编址（现在普遍使用），位编址

	- 零地址空间个数

		- 1三个零地址空间（主存，寄存器，输入输出设备分别编址，叫三零）
		- 
		- 2两个零地址空间，寄存器一个，主存和输入输出一个
		- 3一个零地址空间，所有存储设备统一编址
		- 4隐含编址，没有零地址空间

	- 输入输出设备的非线性编址

		- 第一种，一台设备一个地址
		- 第二种，一台设备两个地址
		- 第三种，一台设备多个地址

	- 并行存储器的编址技术

		- 地址码高位交叉编址
		- 地址码低位交叉编址

- 寻址方式

	- 寻址方式的设计思想：

		- 1直接在指令中给出操作数，称为立即寻址
		- 2寄存器寻址，指令在执行过程中需要的操作数来源于寄存器
		- 3主存寻址

			- 包括直接寻址方式，间接寻址方式（给出操作数地址的地址）和变址寻址方式

		- 4堆栈寻址

- 定位方式

	- 逻辑地址与物理地址
	- 直接定位方式
	- 静态定位方式
	- 动态定位方式

### 指令格式的优化设计

- 指令的组成

	- 

- 操作码的优化表示

	- 固定长度操作码
	- Huffman编码法
	- 扩展编码法

		- 

- 地址码的优化表示

	- 地址码个数的选择

		- 三地址，二地址，一地址，零地址

	- 缩短地址码长度的方法

		- 1用间接寻址方式减少地址码长度
		- 2用变址寻址方式缩短地址码长度
		- 3用寄存器间接寻址方式缩短地址码长度是最有效的方法

- 指令格式设计举例

	- 目前绝大多数计算机系统中，指令长度通常取8的倍数，当一个指令长度小于一个存储字时，不要跨越存储字存放

### 指令系统的功能设计

- 基本指令系统

	- 数据传送类指令
	- 运算类指令
	- 程序控制指令
	- 输入输出指令
	- 处理机控制和调试指令

- 复杂指令系统CISC

	- 目标程序优化

		- 增强数据传送指令的功能
		- 增强运算型指令的功能
		- 增强程序控制指令的功能

	- 对高级语言和编译程序的支持

		- 增强对高级语言和编译程序的指令的支持
		- 高级语言计算机

	- 操作系统的优化实现

		- 

- 精简指令系统RISC

	- 从CISC到RISC

		- 20%与80%的规律
		- VLSI技术的发展引起的问题
		- 软硬件的功能分配问题

	- RISC的定义与特点

		- RISC是一种计算机体系结构的设计思想
		- 

	- 减少指令平均执行周期数是RISC思想的精华

		- 

	- RISC的关键技术

		- 延时转移技术
		- 指令取消技术
		- 重叠寄存器窗口技术
		- 指令流调整技术
		- 硬件为主固件为辅

	- RISC优化编译技术

## 存储系统（用速度，容量，价格表示存储系统的性能）

### 存储系统原理

- 存储系统的定义

	- 存储器分类，从材料上看：

		- SRAM静态存储器，DRAM动态存储器，磁表面存储器，光存储器

	- 存储器分类，从存储器访问方式看：

		- 直接译码，相联访问，随机访问，块交换，手工加载

	- 定义：两个或两个以上，容量、速度和价格各不相同的存储器在软件、硬件或软件与硬件相结合的方式连接起来的一个系统。它的容量接近里面最大的存储器的容量，价格接近里面最便宜的存储器的价格，速度接近里面快速度的存储器。并且它在应用程序员层面来看是透明的，相当于一个存储器。
	- 存储容量S
	- 单位容量的平均价格C

		- 

	- 访问周期T（又称存储周期，存取周期，存取时间等）

		- 

	- 

- 存储器的层次结构

	- 

- 频带平衡

	- 存储器的访问速度能不能跟上系统的需要，即频带平衡问题

		- 存储器频带计算：

	- 频带平衡问题解决：

		- 1多个存储器并行工作，2采用缓冲器，3使用存储系统，特别是cache存储系统

- 并行存储器

	- 多个独立的存储器并行工作，一个存储周期内可以访问到多个数据

		- 并行访问存储器
		- 交叉访问存储器

			- 高位交叉访问存储器
			- 低位交叉访问存储器

		- 一种无冲突访问存储器，解决低位交叉等的数据访问冲突等

### 虚拟存储器

- 地址映像与变换：虚拟存储地址，主存地址，辅存（磁盘）地址空间

	- 页式虚拟存储器
	- 段式虚拟存储器
	- 段页式虚拟存储器
	- 外部地址变换

		- 

- 虚拟存储器工作原理

	- 

- 加快内部地址变换的方法

	- 目录表

		- 目录表的思想是：压缩页表的存储容量，用一个速度比较快的高速存储器来存放其内容，从而加快页表的查表速度

			- 

	- 快慢表

		- 快表TLB是慢表的一部分副本，快表存放在高速缓冲器中，慢表存放在主存。是对目录表的优化

			- 

	- 散列函数（优化快表的命中）

- 页面替换算法及其实现

	- 页面替换算法

		- 1随机算法RAND
		- 2先进先出算法FIFO
		- 3近期最少使用算法LRU
		- 4最久没有使用算法LFU
		- 5最优替换法OPT

	- 堆栈型替换算法

		- 

	- 页面替换算法的实现

- 提高主存命中率的方法

	- 影响主存命中率的因素
	- 页面大小的选择
	- 主存容量
	- 页面调度方式

		- 两种：分页式和请求页式

### 高速缓冲存储器

- 基本工作原理

	- 

- 地址映像与变换方法

	- 全相联映像及变换
	- 直接映像及其变换
	- 组相联映像及其变换
	- 
	- 位选择组相联映像及其变换
	- 段相联映像及其变换

- cache替换算法及其实现

	- 轮换法及其实现

		- 1每块一个计数器，2每组一个计数器

	- LFU算法及其实现

		- 设置计数器

	- 比较对法

		- 也是一种LFU，采用硬联逻辑实现

	- 堆栈法

		- 堆栈法使用了LFU算法

			- 

- cache的性能分析

	- cache系统的加速比

		- 1命中率与容量的关系

			- 

		- 2命中率与块大小的关系
		- 3命中率与组数的关系
		- 

	- cache的一致性问题

		- 解决cache不一致：写直达法和写回法

	- cache的预取算法

		- 1按需取，2恒预取，3不命中预取

### 三级存储系统

- 1两个存储系统组织方式，2一个存储系统组织方式，3全cache系统
- MMU存储管理部件

## 输入输出系统

### 输入输出原理

- 输入输出系统的特点

	- 异步性
	- 实时性
	- 与设备无关性
	- 定义：计算机系统中，通常把处理机和主存以外的部分叫做输入输出系统，包括输入输出设备，输入输出接口和输入输出软件等。

- 输入输出系统的组织方式

	- 自治控制
	- 层次结构

		- 

	- 分类组织

- 基本输入输出方式

	- 程序控制输入输出

		- 

	- 中断输入输出方式
	- 直接存储器访问（DMA）

		- 
		- 分为周期窃取和直接存取

### 中断系统

- 中断源的组织（引起中断的各种事件称为中断源）

	- 中断源的种类

		- 1由外围设备引起的中断
		- 2由处理机产生的中断
		- 3由存储器产生的中断
		- 4由控制器产生的中断
		- 5由总线产生的中断
		- 6实时过程控制产生的中断
		- 7实时钟的定时中断
		- 8多处理机系统中，从其他处理机发过来的中断
		- 9程序调试过程中，中断点的中断
		- 10硬件故障中断
		- 11电源故障中断

	- 中断源的分类组织

		- IBM公司将中断源分为六类：

			- 1重新启动中断
			- 2机器检验出错中断
			- 3程序性错误引起的中断
			- 4访问管理程序中断
			- 5外部事件中断
			- 6输入输出中断

		- 可屏蔽中断和不可屏蔽中断，即一般中断和异常中断

	- 中断优先级

		- 决定优先级的因素：

			- 1中断源的急迫性
			- 2设备的工作速度
			- 3数据恢复的难易程度
			- 4要求处理机提供的服务量

		- 现代计算机中断优先级一般用硬件排队器实现

- 中断系统的软硬件功能分配

	- 决定因素：中断响应时间和灵活性
	- 中断处理过程

		- 

	- 中断响应时间：

		- 1最长指令执行时间
		- 2在一条指令完成后，处理其他更紧急任务所用时间
		- 3从第一次“关CPU中断”到第一次“开CPU中断”所经历的时间
		- 4多个中断源同时请求中断，通过软件找到相关中断源的中断服务程序入口所经历的时间

	- 识别中断源的查询法
	- 识别中断源的串行排队链法和中断向量法

		- 用硬件完成中断源排队

	- 识别中断源的独立请求法

		- 为克服串行排队链法可靠性差的缺点

	- 中断现场的保存和恢复

- 中断屏蔽

	- 1每个中断源设置一个中断屏蔽位
	- 2改变处理机优先级方法

### 通道处理机

- 通道的作用和功能
- 通道的工作过程

	- 

- 通道种类

	- 

- 通道中的数据传送过程
- 通道的流量分析

### 输入输出处理机

- 输入输出处理机的作用
- 输入输出处理机的种类

	- 两大类：共享主存储器和不共享主存储器的输入输出处理机

- 输入输出处理机的特点

## 标量处理机

只有标量数据表示和标量指令系统的处理机称为标量处理机。,


设计处理机的基本任务是要缩短指令解释的时间。,


指令解释时间缩短途径：1提高处理机的工作主频，2采用更好的算法和设计更好的功能部件，3多条指令并行执行，称为指令级并行技术。


### 先行控制技术

先行控制技术的关键是缓冲技术和预处理技术，以及这两种技术的结合。


- 指令的重叠执行方式

	- 顺序执行
	- 一次重叠

	  一次重叠：,
	  
	  
	  如一条指令分取指，分析，执行三个阶段，第k条指令的执行阶段和第k+1条指令的取指阶段同时发生。
	  
	  
	- 二次重叠

	  二次重叠：取k+1条指令与分析k条指令同时进行，分析k+1条指令与执行k条指令同时进行。
	  
	  
- 先行控制方式的原理和结构

	- 原理

	  先行控制技术的关健是缓冲技术和预处理技术，缓冲技术的关键是在两个处理速度不固定的功能部件之间设置缓冲栈，用以平滑他们的工作。在采用先行控制方式的处理机中，一般要设置四个缓冲栈。预处理技术是把进入运算器的指令都处理成寄存器—寄存器（RR型）型指令，他与缓冲技术相结合，为进入运算器的指令准备好所有所需操作数。
	  
	  
	- 处理机结构

		- 

	- 指令执行时序
	- 先行缓冲栈

		- 先行指令缓冲栈
		- 先行操作栈
		- 先行读数栈
		- 后行写数栈

	- 缓冲深度的设计

	  在设计先行控制器时，各个缓冲栈中缓冲寄存器的个数设置，即“缓冲深度”问题。
	  
	  
- 数据相关

	- 解决数据相关的方法

		- 推后分析法
		- 设置专用路径读取所需数据

	- 指令相关
	- 主存操作数相关
	- 通用寄存器数据相关
	- 变址相关

- 控制相关

	- 无条件转移
	- 一般条件转移
	- 复合条件转移
	- 转移预测技术

		- 软件“猜测法”
		- 硬件“猜测法”
		- 两个先行指令缓冲栈

	- 短循环程序的处理

### 流水线处理机

两个方面开发处理机内部的并行性，一个从空间，一个从时间。空间即加重复资源，设置多个操作部件，并让其并行处理，叫做多操作部件处理机，又叫超标量处理机。时间即流水线处理。


- 流水线工作原理

  流水线工作方式是把一个重复的过程分解为若干个子过程，每个子过程可以和其他子过程同时进行。类似工厂流水线，故叫流水线。,
  
  
  指令流水线,
  
  
  部件流水线,
  
  
  访问主存，处理机之间也可以采用流水线，类比，从微到小到中到大均可用到这一思想。
  
  
	- 从重叠到流水线

	  分阶段后（分析，执行），每个阶段有个锁存器，用来存储该阶段执行结果，也是每个阶段可以独立的原因。
	  
	  
	- 时空图

		- 

	- 流水线的特点

		- 流水线中处理的必须是连续任务
		- 把一个任务分解为几个有联系的子任务，每个子任务由一个专门的功能部件来实现。
		- 在流水线的每一个功能部件后面都要有一个缓冲寄存器，或称为锁存器、闸门寄存器，用来保存本段的执行结果。
		- 流水线中各段的时间应尽量相等
		- 流水线需要有装入时间和排空时间

	- 流水线的分类

		- 线性流水线与非线性流水线

		  按照流水线各个功能段之间是否有反馈信号，将流水线分为线性流水线和非线性流水线。
		  
		  
			- 非线性流水线

			  非线性流水线经常用于递归调用。
			  
			  
				- 连接图
				- 预约表
				- 

		- 流水线的级别

			- 功能部件级

				- 也称为运算操作流水线，部件里面的流水线。如比较复杂的运算操作部件，浮点加法器，浮点乘法器等，一般要采用多级流水线来实现。

			- 处理机级

				- 又称指令流水线，即一条指令执行过程分多个阶段，每个阶段用不同的部件来处理。

			- 处理机间级

				- 又称宏流水线

		- 单功能与多功能流水线

			- 单功能流水线

			  一条流水线只能完成一种固定的功能。
			  
			  
			- 多功能流水线

			  流水线的各段可以进行不同的连接，在不同的时间内，或者同一时间内，根据不同的连接可以实现不同的功能。
			  
			  
				- 

		- 静态流水线与动态流水线

		  在多功能流水线中按照在同一时间内，是否可以连接成多种方式，执行多种功能，将流水线分为静态和动态。
		  
		  
			- 

		- 其他流水线分类（按照不同角度）

			- 标量流水线和向量流水线
			- 在线性流水线中，根据对流水线的控制方式不同，分为同步和异步
			- 按照流水线输出端流出的任务与输入端流入的任务顺序是否相同分为顺序流水线和乱序流水线

	- 线性流水线的性能分析

		- 吞吐率

			- 单位时间内流水线完成的任务数量或结果数量（TP=n/Tk）称为吞吐率

		- 加速比

			- 完成一批任务，不使用流水线所用的时间与使用流水线所用的时间之比称为加速比S=T0/Tk

		- 效率

			- 指流水线的设备利用率

		- 流水线最佳段数的选择
		- 流水线性能分析举例

	- 非线性流水线的调度技术

		- 非线性流水线的表示

			- 

		- 非线性流水线的冲突

			- 
			- 非线性流水线的启动循环

			  使非线性流水线的每天一个功能段在任何时钟周期都不发生冲突的循环数列称为启动循环。
			  
			  
			- 恒定循环

			  只有一个启动距离的启动循环称为恒定循环
			  
			  
			- 禁止向量

			  把一条非线性流水线的所有禁止启动距离组合在一起形成的数列称为这条非线流水线的禁止向量
			  
			  
			- 由预约表得到禁止向量的方法

			  预约表中每一行x之间的距离计算出来，去掉重复的后，组合成一个数列，这个数列就称为这条流水线的禁止向量。
			  
			  
		- 无冲突调度方法

			- 冲突向量
			- 状态图
			- 非线性流水线调度的主要目标是找出平均启动距离最小的启动循环

		- 优化调度方法

			- 采用预留算法来调度非线性流水线，达到最优调度（具体方法：）

				- 确定流水线的最小平均启动距离，同一个任务通过流水线任意一个功能段的最多次数。x的次数
				- 确定最小启动循环
				- 结合流水线预约表和连接图，采用预留算法，通过插入非计算延迟功能段实现最小启动循环。

					- 

	- 局部相关

		- 流水线充分发挥效率，需要：

			- 软件方面

				- 编译器生产的目标程序要能够适合流水线结构

			- 硬件方面

				- 解决好存储器系统的频带平衡问题，为流水线提供足够的指令和数据

			- 处理好局部相关和全局相关

		- 顺序流动与乱序流动
		- 指令流水线中，三种局部相关：

			- 先写后读
			- 先读后写
			- 写写相关

		- 数据相关及其避免方法

		  流水线中的数据相关在逻辑设计中通常称为“冒险”或“竞争”。
		  
		  
			- 延迟执行
			- 专用路径

		- 数据重定向
		- Tomasulo动态指令调度算法

		  又被称为公共数据总线法（CDB），令牌法。通过乱序流动的方式来处理流水线，并通过分散控制来处理数据相关。
		  
		  
	- 全局相关

	  条件转移或程序中断引起的中断。
	  
	  
		- 转移的影响

			- 条件转移对流水线影响非常大，处理措施：

				- 延迟转移和指令取消
				- 静态转移预测
				- 动态转移预测技术

					- 方法一：在指令cache中记录转移历史信息
					- 方法二：转移目标地址缓冲栈
					- 方法三：转移目标指令缓冲栈

				- 提前形成条件码

		- 精确断点与不精确断点

			- 可能的程序性错误

				- 指令或数据格式错
				- 主存保护
				- 非法操作码
				- 地址越界
				- 各种运算结果溢出
				- 调用管理程序等

			- 可能的机器故障

				- 信息校验错误

					- 电源故障
					- 运算电路误动作
					- 主存储器出错
					- 输入输出设备或控制器出错
					- 机器的其他各种硬件故障

				- 虚拟存储器缺页

### 超标量与超流水线处理机

- 超标量处理机

  微处理机i860，i960，奔腾处理机等都是超标量处理机
  
  
	- 基本结构

	  超标量处理机的典型结构是有多个操作部件，一个或几个比较大的通用寄存器堆，一个或两个高速cache。先进的超标量处理机一般都包含三个处理单元，一个是定点处理单元，通常称为中央处理单元（CPU），它由一个或多个整数处理部件组成；第二个是浮点处理单元（FPU），它由浮点加减法和浮点乘除法组成；第三个是图形加速部件，也称为图形处理单元（GPU）。,
	  
	  
	  把指令cache和数据cache分开的结构称为哈佛结构（Harvard）。
	  
	  
	- 单发射与多发射

		- 单发射处理机，即在一个时钟周期只能处理一条指令的处理机
		- 多发射处理机，在一个基本时钟周期能在指令cache中同时读出多条指令，对多条指令进行译码。
		- 把一个时钟周期内能同时发射多条指令的处理机称为超标量处理机

	- 多流水线调度

	  多流水线调度问题非常复杂，是一个NP完成问题。,
	  
	  
	  NP完全问题(NP-C问题)，是世界七大数学难题之一。NP的英文全称是Non-deterministic Polynomial Complete的问题，即多项式复杂程度的非确定性问题。简单的写法是NP=P？，问题就在这个问号上，到底是NP等于P，还是NP不等于P。
	  
	  
		- 顺序发射

		  指令的发射顺序是按照程序中的指令排列顺序进行的。
		  
		  
		- 乱序发射
		- 顺序完成
		- 乱序完成

	- 资源冲突
	- 超标量处理机性能

- 超流水线处理机

  利用时间并行性，在一个基本时钟周期分时发射多条指令。或者把分段级数大于等于8的流水线处理机称为超流水线处理机。
  
  
	- 指令执行时序
	- 典型处理机结构

		- 

	- 超流水线处理机性能

- 超标量超流水线处理机

	- 指令执行时序
	- 典型处理机结构

		- EBOX整数执行部件
FBOX浮点执行部件
ABOX地址部件
IBOX中央控制部件

	- 超标量超流水线处理机性能

## 向量处理机

向量处理机目前是解决数值计算的一种重要的高性能计算机结构。两个优点：效率高和适用性广。,


undefined,


undefined


### 向量处理机的基本概念

- 什么是向量处理

	- 标量指令序列
	- 向量处理

- 向量处理的方式

  大型数组的计算一般包含向量计算。按照数组中各计算相继的次序，可以把向量处理的方式分为三种：横向处理方式，纵向处理方式，纵横处理方式。
  
  
	- 横向处理
	- 纵向处理
	- 纵横处理

### 向量处理机的结构

向量处理机的基本思想是把两个向量的对应分量进行运算，产生一个结果向量。


- 向量处理机设计者面临的问题

  系统结构设计者面临的问题是设计出一个能满足处理器带宽要求的存储系统
  
  
- 存储器—存储器结构
- 寄存器—寄存器结构

### 向量处理机的存取模式和数据结构

- 数值算法的存取模式

  计算机系统结构必须有负载相适应，这样才能获得高性能。就是说高性能系统结构做高性能要求的事。
  
  
	- 稠密矩阵
	- 高斯消去法

- 向量处理机的数据结构

### 提高向量处理机性能的方法

- 向量处理机系统结构的设计目标

	- 较好的维持向量/标量性能平衡
	- 可扩展性随处理机数目的增加而提高

	  可扩展性的简单定义：随处理机的数目增加，系统的性能应线性提高。
	  
	  
		- 规模可扩展性
		- 换代可扩展性
		- 问题可扩展性

	- 增加存储器系统的容量和性能
	- 提供高性能的IO和易访问的网络

- 提高向量处理机性能的常用技术

	- 链接技术

	  向量指令可分为四类
	  
	  
		- 第一类向量指令
		- 第二类指令
		- 第三类指令
		- 第四类指令

	- 向量循环或分段开采技术

	  当向量的长度大于向量寄存器的数目时，必须把长向量分成长度固定的段。处理长向量的程序结构称为向量循环。这种技术也称为分段开采，一次处理一个向量段。
	  
	  
	- 向量递归技术

	  结果操作数与源操作数使用同一个向量寄存器，结果递归操作传输至源操作数所在的向量寄存器。
	  
	  
	- 稀疏矩阵的处理技术

	  我们把许多元素值为零的矩阵称为稀疏矩阵
	  
	  
### 向量处理机实例

- 向量处理机的历史与现状

	- 
	- 
	- 向量协处理器

	  科学计算要求计算机系统能高速的处理大量数据，向量处理机较好的解决了这一问题，如CDC STAR,Cray1向量处理机。但是这些机器都是巨型的，规模大，价格高，适用于解决大工程和大系统的问题。一般科学计算的用户不可能，也不必去买一台价格昂贵的巨型机，因而只能在中小型计算机上用标量的处理方式处理向量问题。但是，这样的话，效率低，不能满足用户需求，因此产生了向量协处理器。用来处理向量问题的处理器，作为中小型计算机的外围设备，与之结合起来，价格能接受，处理向量问题效率提高。
	  
	  
### 向量处理机的性能评价

- 向量指令的处理时间Tvp

	- 一组向量操作的执行时间取决于

		- 向量长度
		- 向量操作之之间是否存在流水部件的冲突和数据的相关性

	- 把几条能在一个时钟周期内执行的向量指令称为一个编队

- 最大性能R∞

  Ｒ∞表示向量长度无穷大时候，向量流水线处理的最大性能。常在评价峰值性能时使用，单位MFLOAPS。
  
  
- 半性能向量长度n1/2

  达到一半R∞值所需的向量长度
  
  
### 关于向量处理机的几点看法

- 向量计算机系统结构发展趋势

	- 提供向量指令
	- 除具有向量处理功能外还具有其他功能
	- 采用多层次的存储器系统
	- 流水线技术与并行技术相结合

- 向量计算机系统结构如何解决这几个问题

	- 处理器带宽

	  运算器采用流水线结构，多个运算器组成并行系统
	  
	  
	- 存储器带宽

	  彼此独立的存储体构成存储器系统，随着存储体数目增加，存储器带宽增加。采用多级存储，高速缓冲存储器和可寻址的寄存器组。
	  
	  
	- 输入输出系统带宽

	  一般存储器带宽增加，输入输出系统带宽也增加了。
	  
	  
	- 通信带宽

	  一种情况下，通信带宽与存储器带宽同一个值。现讨论的向量处理机系统不涉及处理器之间的通信。
	  
	  
	- 同步

	  对于单条流水线来说，运算是按进入流水线的顺序，所以同步是自动进行的。
	  
	  
	- 多用途

## 互联网络

### 互联网络的基本概念

- 互联网络的作用

  互联网络是开关元件按照一定的拓扑结构和控制方式构成的网络，用来实现计算机系统结构内部多个处理机或多个功能部件之间的相互连接。
  
  
	- 

- 互联函数

  互联函数也称为置换函数或排列函数
  
  
	- 恒等置换

		- 

	- 交换置换

		- X0上面的一条横线代表二进制0位取反

	- 方体置换

		- 

	- 均匀洗牌置换

		- 子洗牌，超洗牌，逆均匀洗牌，简单理解子洗牌就是低到高k位左循环移一位，超洗牌就是高到低k位左循环移一位。

	- 蝶式置换

		- 子蝶式和超蝶式

	- 位序颠倒置换

		- FFT指快速傅里叶变换（fast Fourier transform）

	- 移数置换

		- 

	- 加减2^i置换

		- 其实也是一种移数置换

- 互联网络的特性和传输的性能参数

	- 互联网络的特性

		- 网络规模

			- 网络中结点数称为网络规模，它表示该网络能连接的部件多少。

		- 结点度

			- 

		- 距离

			- 两结点之间相连的最少边数

		- 网络直径

			- 网络中任意两个结点之间距离的最大值

		- 等分宽度

			- 

		- 结点间的线长

			- 它是两个结点间线的长度

		- 对称性

			- 假若从任何结点看拓扑网络都是一样的话，就称该网络为对称网络

	- 网络的传输性能参数

		- 
		- 频宽
		- 传输时间
		- “飞行”时间
		- 传输时延
		- 发送方开销
		- 接收方开销
		- 总时延

			- 

	- 互联网络的种类

		- 静态互联网络

			- 线性阵列
			- 环和带弦环
			- 循环移数网络
			- 树形和星形
			- 胖树形
			- 网格形和环网形
			- 搏动式阵列
			- 超立方体
			- 带环立方体
			- k元n-立方体网络

		- 动态互联网络

			- 总线
			- 开关模块
			- 多级网络
			- 欧米伽网络
			- 基准网络
			- 交叉开关网络

		- 其他分类法

			- 

### 消息传递机制

- 消息寻径方式

	- 消息格式

		- 

	- 线路交换
	- 包交换

		- 存储转发寻径
		- 虚拟直通寻径
		- 虫蚀寻径

			- 会将包分成更小的片

- 死锁和虚拟通道

	- 虚拟通道

		- 每对缓冲区组成一条虚拟通道

	- 死锁的产生和避免

- 流控制策略

	- 包冲突的解决

		- 通道流水线上两个相邻结点要传输片时，必须具备三个条件：1源缓冲区已存有该片，2通道已分配好，3接收缓冲区准备接收该片。

			- 

	- 确定寻径和自适应寻径

		- 确定寻径（基于维序概念：）

			- 二维网格网络的x—y寻径
			- 超立方体网络的E立方体寻径

		- 自适应寻径

- 选播和广播寻径算法

	- 单播：一个源结点发送消息到一个目的结点
	- 选播：一个源结点发送消息到多个目的结点
	- 广播：一个源结点发送消息到全部结点
	- 会议：针对于多对多情况
	- 贪婪选播算法的思想：向那些可达到最多剩余目的结点的维方向发送包

### 互联网络实例

- 总线互连
- 环形互连
- 交叉开关互连
- 混洗交换互连和合并开关

	- 

- Omega网络

	- 

- 蝶形操作

	- 

- 合并网络和取与加指令

## SIMD计算机

undefined,


与向量计算机的区别：实现方式不一样，simd为资源重复来提速，向量处理机为时间重叠来提速，在并行性上，一个为向量流水计算机，一个为向量并行计算机。


### SIMD计算机模型

- 
- SIMD计算机的操作模型可以用五元组来表示M=（N，C，I，M，Ｒ）

	- N为机器的处理单元（PE）数
	- C为由控制部件（CU）直接执行的指令集
	- I为CU广播至所有PE并行执行的指令集
	- M为屏蔽方案集
	- Ｒ是数据寻径功能集
	- 可以用五元组来描述一台具体的SIMD机器

### SIMD计算机的基本结构

- 分布式存储器结构

	- 

- 共享存储器结构

	- 

- SIMD计算机的特点

  向量处理机和SIMD处理机都能对大量数据做向量运算处理，1与流水线向量处理机一样，特别适用于高速数值计算；2SIMD计算机利用大量处理单元对向量包含的各个分量同时进行运算；3SIMD计算机与流水线向量处理机的另一区别在于它的互联网络；4SIMD计算机一重要特点，它基本上是向量处理专用计算机
  
  
### SIMD计算机实例

- Illiac IV阵列处理机

	- illiac IV阵列
	- 阵列控制器
	- 输入输出系统

- BSP计算机

	- 并行处理机
	- 控制处理机
	- 文件控制器
	- 对准网络
	- 质数存储系统

- CM—2计算机

	- 处理阵列
	- 寻径器，NEWS网格和扫描机构
	- 输入输出系统

- MasPar MP—1系统

	- PE阵列
	- 处理单元和存储器
	- 阵列控制部件
	- 并行磁盘阵列

### SIMD计算机的应用

- 数值应用问题的特征

	- 大型数值问题的分类

		- 连续模型
		- 离散模型

	- 适合于连续模型的SIMD系统结构

		- 求解泊松问题

	- 数据流需求

- 算法举例

	- 有限查分问题
	- 矩阵加
	- 矩阵乘
	- 累加和
	- 递归技术
	- 递归加倍法与循环归约法

### 连续模型的结构向何处发展

## 多处理机

### 多处理机结构

- 两种多处理机结构

	- 共享存储器，共享IO
	- 自己（各自本地）存储器，自己的IO

- 多处理机系统的特点（属于MIMD计算机）

	- 结构灵活性
	- 程序并行性
	- 并行任务派生
	- 进程同步
	- 资源分配和进程调度

### 多处理机性能模型（R/C比值）R代表程序执行时间，C代表通信开销

多处理机的模型，指的是使多处理机的利用率和效率，性能在一种普遍或特定情况下达到较好或者理想效果的方案，与多处理机间通信和任务分配，调度等的方案有关，谓之模型


- 基本模型
- N台处理机系统的基本模型
- 随机模型
- 通信开销为线性函数的模型
- 一个完全重叠通信的理想模型
- 一个具有多条通信链的模型
- 多处理机模型

### 多处理机的cache一致性

- 问题由来

	- 共享可写数据引起的不一致性
	- 进程迁移引起的数据不一致性
	- I/O传输造成的数据不一致性

- 问题解决

	- 监听协议

		- 监听协议概述
		- 采用Write—Through策略的cache（缓存有效和无效两种状态）
		- 采用Write—Back策略的cache
		- 写一次Write—once协议

	- 基于目录的协议（即将所有cache存储拷贝建立一个cache目录，存放对应指针等数据，若有重写，通过目录定位块，进行标志位重置，如设置无效等）

		- 目录结构及使用
		- 全映射目录
		- 有限目录
		- 链式目录

### 多处理机实例

- MPP

	- 大规模并行处理系统。用的VLSI硅片，砷化镓技术，高密度组装和光技术，采用可拓展技术，共享虚拟存储技术，容许时延技术多线程技术的系统架构。（实现系统：CM—5系统）

		- 同步的MIMD机器
		- CM—5网格系统结构
		- 控制处理机和处理结点

- SMP

	- 共享存储型多处理机，也称为对称性多处理机。

		- 三种模型（各个模型区别在于存储器和外围资源如何共享或分布）

			- 均匀存储器存取（UMA）
			- 非均匀存储器存取（NUMA）
			- 只用高速缓存的存储器结构COMA

		- S2MP体系结构

			- 实际上是一种NUMA结构

		- SGI Origin2000系列服务器

			- 该系列服务器结构

				- 结点板
				- I/O子系统
				- 互联网络子系统
				- 分布式共享存储地址空间
				- cache一致性（基于目录协议）
				- 系统时延
				- 系统带宽
				- 扩展连接方式
				- 性能评价

### 机群系统

- 机群系统的组成、特点和关键技术

	- 机群系统是用高性能通用网络将一些高性能工作站或高档PC机通过某种结构连接起来，并在并行程序设计以及可视化人机交互集成开发环境支持下，统一调度，协调处理，实现高效并行处理的系统。
	- 机群系统特点

		- 系统开发周期短
		- 用户投资风险小
		- 系统价格低
		- 节约系统资源
		- 系统拓展性好
		- 用户编程方便

	- 机群系统的关键技术

		- 高效的通信技术
		- 并行程序设计环境
		- 多种并行语言的支持
		- 全局资源的管理与利用

- 机群系统通信技术

	- 影响通信系统性能的因素

		- 网络带宽低
		- 传统TCP/IP多层次结构带来了很大的处理开销
		- 协议复杂的缓冲管理增加了网络延迟
		- 操作系统额外开销不可忽视

	- 提高通信系统性能的方法措施

		- 采用新型高速网络提高网络带宽

			- 快速以太网，ATM，Myrinet

		- 设计新的通信协议，降低通信延迟

			- 在用户空间实现通信协议
			- 精简通信协议
			- Active Message通信机制

	- 几种典型系统

- 并行程序设计环境

	- PVM
	- XPVM
	- MPI
	- EXPRES
	- Linda
	- IPCE

- 机群系统负载平衡技术

	- 负载平衡的基本问题

		- 评价标准

			- 吞吐率、可拓展性、容错性

		- 负载平衡要解决的问题

			- 系统资源使用不均
			- 机群系统是多用户系统，同时可能有多个系统在运行各自的作业。保证前台用户对工作站的优先使用权。

	- 负载均衡的主要技术

		- 负载平衡决策时机（静态和动态两类）
		- 调度系统模式
		- 负载指标的设计与收集
		- 负载调度策略

	- 负载均衡系统设计的考虑因素

		- 网络
		- 机器结构
		- 系统利用状况
		- 系统的可靠性
		- 编程模型

	- 机群系统负载平衡技术的研究状况

		- 现有系统：美国CONDOR系统等

## 多处理机算法

### 简单并行性

- do par和do seq结构

	- do par表示并行执行循环
	- do seq表示串行执行循环

- 阻塞同步
- 性能分析

	- 把修改共享变量作为一个基本操作，叫做Synch
	- SYPS叫做每秒同步数，MSYPS叫做每秒做百万个Synch

- 增大粒度
- 任务的初始化

### 同步技术

- 使用测试与设置指令的同步技术

	- Lock，ulock，update操作共享数据信号灯
	- 使用增1和减1指令的同步技术

		- 死锁和活锁

	- 使用比较与交换指令的同步技术

		- 比较与交换指令

	- 使用取与加指令的同步技术

		- 取与加同一个数据存储区，或者操作共享的传输通道，所以会串行的获取资源

### 并行搜索

- 搜算单峰函数的极大值
- 并行分支限界法

	- 旅游商问题，NP问题

### 串行算法到并行算法的转换

- 相关性分析
- 开发迭代的并行性

### 同步并行算法和异步并行算法

多处理机的并行算法是可以同时运行和协调的解决给定问题的一组k个并发进程。


- 同步并行算法

	- 存在这样一个进程，它的某个进程必须在程序的另一个进程完成后才被激活

- 异步并行算法

	- 每个异步并行算法有一组所有进程都能访问到的全程变量

### 并行程序设计语言及其实现方法

- 并行程序设计语言的特点

	- 并行程序设计语言要有描述程序并行性的能力
	- 程序并行性分为控制并行性和数据并行性

- 并行程序设计模型（程序设计模型是一种程序抽象的集合，给程序员提供了一幅计算机硬件/软件系统透明的简图）

	- 共享变量模型
	- 消息传递模型
	- 数据并行模型
	- 面向对象模型

- 并行程序设计语言涉及的关键技术

	- 进程管理
	- 进程通信与同步

- 并行程序设计语言的的实现途径

	- 新语言编译器
	- 预编译处理
	- 并行函数类库
	- 并行化编译系统

### 结论

- 多处理的应用依赖于几个问题的解决

	- 消除MSYPS瓶颈
	- 减少任务调度的开销
	- 解决cache存储器一致性问题或提供快速的局部存储器
	- 串行程序到并行程序的转换
	- 发掘有用的并行性和消除浪费的并行性

## 计算机系统结构的新发展

### 数据流计算机

- 数据驱动原理

	- 数据流计算机采用数据驱动方式工作
	- 基本原理

		- 当且仅当指令所需要的数据可用时，该指令即可执行
		- 任何操作都是纯函数操作

	- 串行控制流与并行控制流（冯，诺一曼，并行计算机）
	- 数据流计算机中指令的执行过程
	- 数据驱动四个性质

		- 异步性
		- 并行性
		- 函数性
		- 局部性

	- 数据流计算机的指令结构

		- 

- 数据流计算机模型

	- 静态数据流计算机模型

		- 数据令牌沿数据流程序图的有向分支线移动到达操作符结点

	- 动态数据流计算机模型

		- 数据令牌可以带标志，称为带标志的数据令牌，数据令牌在数据流程序图的有向分支线移动时，同一个分支线上可以有多个数据令牌同时移动

	- 静态与动态两种数据流计算机的比较

		- 动态数据流计算多了一个符合部件

	- 普遍化的数据流计算机的结构

		- 

- 数据流计算机的性能分析

	- 数据流计算机的优点

		- 高度并行运算
		- 流水线异步操作
		- 与VLSI技术相适应
		- 有利于提高软件生产力

	- 数据流计算机的缺点

		- 操作开销过大
		- 不能有效利用传统计算机的研究成果
		- 数据流语言尚不完善

	- 数据流计算机设计中需要解决的几个问题

		- 

- 数据流程序图和数据流语言

	- 数据流程序图

		- 一种特殊的有向图
		- 1复制结点，2运算结点，3常数发生器结点，4条件分支结点，5条件操作结点

	- 数据流语言

		- 单赋值语言ID语言，VAL语言
		- 函数类语言FP
		- 命令类语言

	- 数据流语言的性质

		- 并行性好
		- 单赋值规则
		- 不产生副作用
		- 结果的局部性
		- 循环程序迭代展开

- 静态数据流计算机结构

	- 静态数据流计算机组成

		- 

	- 分块结构的静态数据流计算机
	- 多处理机结构的静态数据流计算机
	- 静态数据流计算机作为后端机

- 动态数据流计算机结构

	- 网络结构的动态数据流计算机
	- 环形结构的动态数据流计算机
	- 网状结构的动态数据流计算机

- 其他结构的数据流计算机

	- 利用传统多处理机结构的数据流计算机
	- 提高并行级别的数据流计算机
	- 采用多级并行的数据流计算机
	- 同步与异步相结合的数据流计算机
	- 控制流与数据流相结合的数据流计算机

### 数据库机与知识库机

- 数据库机与知识库机模型

	- 软件后端机数据库机与知识库机
	- 智能控制后端机数据库机与知识库机
	- 硬件后端机数据库机与知识库机

- 数据库机和知识库机在智能计算机系统中的作用

	- 由数据库机和知识库机构成智能计算机系统
	- 数据库机和知识库机作为网络系统中的结点机
	- 分布式数据库机与知识库机系统

- 数据库机与知识库机系统结构

	- 数据库机与知识库机的逻辑结构

		- 

	- 数据库机与知识库机的物理结构

		- 

	- 多级存储器结构
	- 操作执行部件的结构
	- 智能接口的结构

- 后端机与前端机的接口

	- 逻辑接口

		- 端点用户查询语言
		- 知识操纵语言
		- 逻辑输入输出语言
		- 物理输入输出语言

	- 物理接口

		- 通信接口
		- 通道接口
		- 共享存储器接口

	- 后端机与前端机之间的接口选择

		- 上面接口的选择组合

- 典型的数据库机与知识库机

	- 
	- 高速数据处理技术

		- 旋转处理技术
		- 散列位阵列处理技术
		- 相联处理技术
		- 多处理机技术

	- 数据库机的分类

		- 单处理机间接索引型
		- 单处理机直接检索型
		- 多处理机直接检索型
		- 多处理机间接检索型
		- 多处理机组合检索型

### 面向函数程序设计语言的归约机

- 函数式语言的归约计算方法

	- 归约基语言
	- 入—exp的基本计算方法

		- 三条规则转换a，b，n

	- 归约计算的语意研究

		- 正规序归约的语意研究

			- 串归约和图归约
			- 全惰性图归约
			- 惰性图归约

	- 图归约的并行实现方法

		- 中间语言
		- 图变换
		- 图归约的并行性开发方法

			- 任何计算机系统中并行性分为保守（任一计算都有效，要被使用）并行性和投机（可能有不被使用的计算乃至无穷计算下，不安全）并行性

		- 并行计算任务的同步
		- 并行计算任务的粒度

	- 并行图归约机的系统结构

		- 并行图归约计算的操作特性

			- 图结点，任务和消息是并行图归约中三个基本成分
			- 

		- 并行图归约机结构

			- 采用分布式的并行存储方式的结构

		- 并行图归约机的存储系统

			- 智能存储系统，包含附加的处理机

		- 并行图归约机的处理机

			- 处理机系统用于执行归约任务

## 实验：DLX处理器

### DLX基本结构

### DLX流水线结构

### 实验环境与内容

